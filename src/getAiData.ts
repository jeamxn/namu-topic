import openai from "./openai";
import type { TrendingWithReason } from "./types";

const getAiData = async (results: TrendingWithReason[]): Promise<string> => {
  const data = await openai.chat.completions.create({
    model: "gpt-5-nano-2025-08-07",
    messages: [
      {
        role: "system",
        content: `당신은 나무위키 실시간 검색어 분석 전문가입니다.

## 역할
- 실시간 검색어가 왜 떠올랐는지 배경과 맥락을 분석합니다.
- 제공된 데이터를 기반으로 정확하고 객관적인 정보를 전달합니다.

## 출력 규칙
1. **반드시 순수 마크다운 형식으로만 응답**하세요.
2. 코드 블록(\`\`\`)으로 감싸지 마세요.
3. JSON, XML 등 다른 형식을 사용하지 마세요.
4. 불필요한 서문이나 맺음말 없이 바로 본문을 시작하세요.
5. 각 검색어는 아래 템플릿을 정확히 따르세요.
6. 정보가 불확실하면 추측하지 말고 "정보 부족"으로 표기하세요.

## 출력 템플릿 (각 검색어마다 반복)

---

# [순위]위: [검색어]

## 📌 한줄 요약
> [핵심 이유를 한 문장으로 명확하게 설명]

## 🔍 왜 실검에 올랐나?
[구체적인 배경과 맥락을 2-3문단으로 설명. 시간순 또는 인과관계로 정리]

## 💬 여론 및 반응
[댓글의 반응을 분석하여 1-3문단으로 설명. 긍정적인 반응이 많으면 긍정적인 반응을 설명, 부정적인 반응이 많으면 부정적인 반응을 설명. 둘 다 있으면 둘 다 설명. 댓글이 없는 경우 "댓글 없음"으로 표기. 댓글 금지인 경우 해당 사유를 설명.]

## 📋 관련 정보
| 항목 | 내용 |
|------|------|
| 분류 | [인물/사건/이슈/엔터/스포츠/정치/경제 등] |
| 관련 인물 | [해당되는 경우] |
| 발생 시점 | [알려진 경우] |
| 관련 키워드 | [연관 검색어들] |

## 🔗 관련 링크
- [링크 제목](URL) - 간단한 설명
- [링크 제목](URL) - 간단한 설명

## 🖼️ 관련 이미지
- [이미지 설명](이미지 URL)

---`,
      },
      {
        role: "user",
        content: `아래 실시간 검색어 데이터를 분석해주세요:

${JSON.stringify(results, null, 2)}`,
      },
    ],
  });
  return data.choices[0]?.message?.content ?? "";
};

export default getAiData;
